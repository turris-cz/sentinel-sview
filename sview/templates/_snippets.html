{%- macro no_data_infobox(source) -%}
	<div style="display:flex;height:70px;width:100%;align-items:center;justify-content:center">
		<strong>
			{%- if source is none or source is undefined -%}
				{{ data_not_cached() }}
			{%- else -%}
				{{ empty_period() }}
			{%- endif -%}
		</strong>
	</div>
{%- endmacro -%}

{%- macro data_not_cached() -%}
	<noscript>
		{{ _("Data source is being cached. Try it later please.") }}
	</noscript>
{%- endmacro -%}

{%- macro empty_period() -%}
	{{ _("No data available from this period.") }}
{%- endmacro -%}

{%- macro data_item(data) -%}
	{%- set len_limit = 10 -%}
	{%- if data|length > len_limit -%}
	<abbr title="{{ data }}">
		{{ data | truncate(len_limit, True, "...", 0) }}
	</abbr>
	{%- else -%}
		{{ data }}
	{%- endif -%}
{%- endmacro -%}
{%- macro country_code_flag(cc) -%}
	<span class="flag-icon flag-icon-{{ cc|lower }}"></span>
{%- endmacro -%}

{%- macro country_code_item(data) -%}
	{{ country_code_flag(data) }}&nbsp;&nbsp;<abbr title="{{data|uncc}}">{{ data }}</abbr>
{%- endmacro -%}

{%- macro spinner_overlay(id) -%}
	<div id="{{ id }}" class="sview-overlay">
		<div class="w-100 d-flex justify-content-center align-items-center">
			<div class="sview-spinner"></div>
		</div>
	</div>
{%- endmacro -%}

{%- macro data_box(id, name, source, data_attr) -%}
	<div class="card mb-3 border">
		<div class="card-header">
			{{ name }}
		</div>
		<div class="card-body" style="position:relative"></ul>
			{{ spinner_overlay("spinner-{}".format(id)) }}
			<div id="{{ id }}">
			{% if source %}
				<table class="table table-borderless table-sm">
				{% for item in source %}
					<tr>
						<td>{{ loop.index }}.</td>
						<td>
							<strong>
								{% if caller %}{{ caller(item[data_attr]) }}{% else %}{{ data_item(item[data_attr]) }}{% endif %}
							</strong>
						</td>
						<td>{{ item.count }}</td>
					</tr>
				{% endfor %}
				</table>
			{% else %}
				{{ no_data_infobox(source) }}
			{% endif %}
			</div>
		</div>
	</div>
{%- endmacro -%}

{%- macro pair_data_box(id, name, source, data_attr1, data_attr2) -%}
	<div class="card mb-3 border">
		<div class="card-header">
			{{ name }}
		</div>
		<div class="card-body" style="position:relative"></ul>
			{{ spinner_overlay("spinner-{}".format(id)) }}
			<div id="{{ id }}">
				{% if source %}
					<table class="table table-borderless table-sm">
						{% for item in source %}
							<tr>
								<td>{{ loop.index }}.</td>
								<td>
									<strong>
										{{ data_item(item[data_attr1]) }}
									</strong>
								</td>
								<td>
									<strong>
										{{ data_item(item[data_attr2]) }}
									</strong>
								</td>
								<td>{{ item.count }}</td>
							</tr>
						{% endfor %}
					</table>
				{% else %}
					{{ no_data_infobox(source) }}
				{% endif %}
			</div>
		</div>
	</div>
{%- endmacro -%}
{%- macro map_box(id, name, source) -%}
	<div id="{{ id }}" style="position: relative; width: 900; height: 300px;"></div>
		{{ spinner_overlay("spinner-{}".format(id)) }}
		{% if source %}
			<script type="text/javascript">
				let scores = {{ source|tojson }};
				draw_map("#{{ id }}", scores);
			</script>
		{% else %}
			{{ data_not_cached() }}
		{% endif %}
{%- endmacro -%}
{%- macro line_box(id, name, source, xkey, ykey, label) -%}
	<div class="card mb-3 border">
		<div class="card-header">
			{{ name }}
		</div>
		<div class="card-body" style="position:relative"></ul>
				{{ spinner_overlay("spinner-{}".format(id)) }}
				<div id="{{ id }}">
					{% if source %}
						{{ morris_line(id, source, xkey, ykey, label) }}
					{% else %}
						{{ no_data_infobox(source) }}
					{% endif %}
				</div>
		</div>
	</div>
{%- endmacro -%}

{%- macro morris_line(id, source, xkey, ykey, label) -%}
	<script type="text/javascript">
		create_graph(
			'{{ id }}',
			'{{ xkey }}',
			{%- if ykey is string %}
				['{{ ykey }}'],
			{%- else %}
				{{ ykey|tojson }},
			{% endif %}
			{%- if label is string %}
				['{{ label }}'],
			{%- else %}
				{{ label|tojson }},
			{% endif %}
			{{ source|tojson }}
		);
	</script>
{%- endmacro -%}

{%- macro await_job(job_id) -%}
	{% if job_id %}
	<div id="await_job_alert" class="alert alert-danger d-none" role="alert"></div>
	<div id="await_job_spinner" class="d-block">
		<div id="await_job_spinner_spinner" class="spinner-border text-primary" role="status">
			<span class="sr-only">Loading...</span>
		</div>
		<span id="await_job_status">
			Please, wait for data being loaded...
		</span>
	</div>
	<script type="text/javascript">
		await_job("{{ url_for("api.await_job") }}", "{{ job_id }}");
	</script>
	{% else %}
		{{ caller() }}
	{% endif %}
{%- endmacro -%}

{%- macro big_period_buttons(resource_names, periods, active_period) -%}
	<div class="col">
		<div class="btn-group-toggle sview-big-time-buttons" data-toggle="buttons">
{%		for period, period_params in periods.items() %}
				<label class="btn btn-outline-secondary js-required">
					<input type="radio" name="options" autocomplete="off"
{%					if period==active_period %}
							checked
{%					endif %}
						onclick='process_new_settings(
							"{{ url_for("api.get_resource_view") }}",
							{{ resource_names|tojson }},
							"{{ period }}"
						)'
					>
					{{ period_params["label"] }}
				</label>
				<noscript>
{%				if period==active_period %}
						<a href="?period={{ period }}" class="btn btn-secondary" name="options" autocomplete="off">
{%				else %}
						<a href="?period={{ period }}" class="btn btn-outline-secondary" name="options" autocomplete="off">
{%				endif %}
					{{ period_params["label"] }}
					</a>
				</noscript>
{%		endfor %}
		</div>
	</div>
{%- endmacro -%}

{%- macro request_missing_resources(resource_names, resources, period) -%}
	<script>
		request_missing_resources(
			{{ resource_names|tojson }},
			{{resources|tojson}},
			"{{ url_for("api.get_resource_view") }}",
			"{{ period }}"
		)
	</script>
{%- endmacro -%}
