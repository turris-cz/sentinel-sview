from flask import Flask, request, jsonify
from pwned_backend.utils import filter_dictionary
from .database import load_postgres


from logging import Logger

_logger = Logger(__name__)

import json

from .backend import proc_leaked

import os

app = Flask(__name__)

try:
    from .config import DevelopmentConfig, ProductionConfig
except ImportError as e:
    if app.config["ENV"] == "testing":
        pass
    else:
        raise ImportError(
            f"You need to setup `config.py` to be able to run this app. Error:{e}"
        ) from e

if app.config["ENV"] == "development":
    app.config.from_object(DevelopmentConfig)

elif app.config["ENV"] == "testing":
    pg_settings = filter_dictionary(os.environ, "POSTGRES")
    app.config.from_mapping(pg_settings)
    app.config["POSTGRES_HOSTNAME"] = "postgres"
else:
    app.config.from_object(ProductionConfig)

db_settings = filter_dictionary(app.config, "POSTGRES")
load_postgres(**db_settings)


